

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Interrupting Threads &mdash; IPython</title>
    <link rel="stylesheet" href="_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="IPython" href="index.html" /> 
  </head>
  <body>
    <div class="header-wrapper">
      <div class="header">
          <div class="logo"><a href="index.html">
            <img class="logo" src="_static/banner.png" alt="Logo"/>
          </a></div>
       
        <div class="rel">
          <a href="index.html">Home</a> · 
<a href="download.html">Download</a> · 
<a href="documentation.html">Documentation</a> · 
<a href="news.html">News</a> · 
<a href="citing.html">Citation</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
             
            
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"> 
<div class="sidebarblock">
<h3>Versions</h3>

<div class="tile"><h4>Stable</h4>
     0.10.2 &ndash; April&nbsp;2011<br/>
    <a href="download.html">Download</a>
</div>

<div class="tile"><h4>Development</h4>
    pre-0.11<br/>
    <a href="https://github.com/ipython/ipython">Github</a>
</div>
</div>
<div class="sidebarblock">
<h3>Links</h3>

  <ul class="simple">
    <li><a class="reference external" href="https://github.com/ipython/ipython/issues">
            Issue tracker</a></li>
    <li>Mailing lists:<br/><span style="padding-left: 1em;">
        <a class="reference external" href="http://projects.scipy.org/mailman/listinfo/ipython-user">
            User</a> · 
        <a class="reference external" href="http://projects.scipy.org/mailman/listinfo/ipython-dev">
            Dev</a>
        </li></span>
    <li><a class="reference external" href="http://webchat.freenode.net/?channels=ipython&uio=d4">
            IRC channel</a><br/>
            <span style="font-size: 0.7em; padding-left: 1em;">(Freenode, #ipython)</span></li>
  </ul>
</div>

<div class="sidebarblock">
  <h3>More Info</h3>
  <ul class="simple">
    <li><a href="faq.html">FAQ</a></li>
    <li><a class="reference external"
    href="presentation.html">Presentations</a></li>
    <li><a class="reference external"
    href="http://ipython.scipy.org/moin/Cookbook">Cookbook</a></li>
    <li><a class="reference external"
    href="http://ipython.scipy.org/moin/Developer_Zone">Developer Zone</a></li>
    <li><a class="reference external"
    href="http://ipython.scipy.org/moin/About/Projects_Using_IPython">Projects using IPython</a></li>
  </ul>          
</div>
        </div>
      </div>
        
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="interrupting-threads">
<h1>Interrupting Threads<a class="headerlink" href="#interrupting-threads" title="Permalink to this headline">¶</a></h1>
<p>ipython supports controlling several GUI toolkits interactively by running the GUI mainloop in a thread.  Currently, GTK, WX, and Qt are the threaded GUI toolkits that ipython supports.  Tkinter is also supported, but because of its privileged relationship with the python shell, it does not need to be run in a thread.</p>
<p>To launch a GUI toolkit in ipython in a thread, use a special flag at launch time</p>
<blockquote>
<div><ul class="simple">
<li>ipython -gthread   # GTK</li>
<li>ipython -wthread   # WX</li>
<li>ipython -qthread   # Qt</li>
</ul>
</div></blockquote>
<p>One of the most common use cases, indeed the one that gave rise to ipython&#8217;s support of GUI threading, is running matplotlib in a thread.  matplotlib supports several GUI toolkits, and if you want to interact with your plot from the ipython shell, you need to start the GUI mainloop in a separate thread.  ipython takes care of these complexities for you if you launch ipython with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ipython</span> <span class="o">-</span><span class="n">pylab</span>
</pre></div>
</div>
<p>ipython will detect your default GUI toolkit from your matplotlib backend (see <a class="reference external" href="http://matplotlib.sf.net/matplotlibrc">http://matplotlib.sf.net/matplotlibrc</a>), start the GUI mainloop in a thread, and import the matplotlib.pylab namespace.</p>
<p>Unfortunately, one of the consequences of running ipython in a threaded mode is that scripts that are &#8220;run&#8221; with ipython&#8217;s &#8220;run&#8221; command are no longer interruptable with CTRL-C.  The details of why this are so are complex and go to the heart of POSIX and python internals, and are beyond the scope of your humble author&#8217;s limited mental capacity, but there is an idiom to work around this problem.</p>
<p>Here is a sample script which is used to illustrate the problem:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylab</span> <span class="kn">import</span> <span class="n">figure</span><span class="p">,</span> <span class="n">show</span>
<span class="c">#lots-o-imports imports and data loading here</span>
<span class="n">storevalues</span> <span class="o">=</span> <span class="n">SomeStorageClass</span><span class="p">()</span>
<span class="k">for</span> <span class="n">somedata</span> <span class="ow">in</span> <span class="n">lots_of_data</span><span class="p">:</span>
    <span class="n">storevalues</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">some_really_expensive_routine</span><span class="p">(</span><span class="n">somedata</span><span class="p">))</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">()</span>
<span class="n">storevalues</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Typically we want to run this script in ipython with:</p>
<div class="highlight-python"><pre>&gt; ipython -pylab
IPython 0.7.2.svn -- An enhanced Interactive Python.
In [1]: run myscript.py</pre>
</div>
<p>The problem is, if in the middle of running this script, we discover a problem that does not raise an exception, we want to interrupt the script with CTRL-C, but because the script is running in a separate thread, and python cannot handle cross thread signal handling, the script cannot get the interrupt signal.  Killing the ipython process externally with &#8220;kill&#8221; will work, but then we may lose a lot of data we&#8217;ve loaded and computed and cached that we may want to reuse in the next &#8220;run&#8221; with &#8220;run -i&#8221;. ipython, however, sets a state flag KBINT  when it sees a CTRL-C which we can check in the inner loop.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">ipbreak</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">IPython.Shell</span>
    <span class="k">if</span> <span class="n">IPython</span><span class="o">.</span><span class="n">Shell</span><span class="o">.</span><span class="n">KBINT</span><span class="p">:</span>
        <span class="n">IPython</span><span class="o">.</span><span class="n">Shell</span><span class="o">.</span><span class="n">KBINT</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span>


<span class="k">for</span> <span class="n">somedata</span> <span class="ow">in</span> <span class="n">lots_of_data</span><span class="p">:</span>
    <span class="n">storevalues</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">some_really_expensive_routine</span><span class="p">(</span><span class="n">somedata</span><span class="p">))</span>
    <span class="n">ipbreak</span><span class="p">()</span>
</pre></div>
</div>
<p>If you are disciplined enough to intersperse &#8220;ipbreak&#8221; calls into the parts of your scripts that are expensive, then when you hit CTRL-C ipython will set the state flag and your script, run in a separate thread, will detect it and raise an exception.  I use SystemExit here which will break out of your script as desired but will not terminate the ipython shell.</p>
<p>Rest assured that though this approach seems inelegant, Fernando is staying awake nights reading papers on cross thread signal handling in POSIX and cannot find anything better at the moment without fundamental and structural changes in python and/or POSIX.</p>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="clearer"></div>
    </div>
    </div>

    <div class="footer-wrapper">
      
    <div class="footer">
        &copy; Copyright the IPython development team.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
    </div>

  </body>
</html>